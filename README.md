# Microservices Pact Contract Testing Example

This repository demonstrates consumer-driven contract testing between two Node.js microservices using [Pact](https://docs.pact.io/):

- **Service A** (Consumer)
- **Service B** (Provider)

The project uses TypeScript, Jest, and Pact to ensure that the contract between the consumer and provider is always in sync.

---

## Project Structure

```
microservices-pact/
├── pact-broker/       # Pact Broker
│   ├── docker-compose.yml
├── service-a/         # Consumer service
│   ├── src/
│   │     ├── app.ts
│   │     ├── client.ts
│   │     ├── server.ts
│   ├── test/
│   │     ├── consumer.pact.spec.ts # Consumer test
│   ├── pacts/
│   ├── publish-pacts.js
│   ├── package.json
│   ├── jest.config.ts
│   └── tsconfig.json
├── service-b/         # Provider service
│   ├── src/
│   │     ├── app.ts
│   │     ├── server.ts
│   ├── test/
│   │     ├── provider.pact.spec.ts # Provider test
│   ├── package.json
│   ├── jest.config.ts
│   └── tsconfig.json
└── README.md
```

---

## Prerequisites

- Node.js (v16+ recommended)
- npm

---

## Getting Started

### 1. Install Dependencies

Install dependencies for both services:

```bash
cd service-a
npm install

cd ../service-b
npm install
```
Alternatively, you can use the `npm run setup` script to install dependencies for both services:

```bash
npm run setup
```

### 2. Running Tests

#### Pact Broker

Runs the Pact Broker:

```bash
npm run start:pact-broker
```

#### Consumer (Service A)

Runs the consumer tests and generates Pact files:

```bash
npm run test:service-a
```

Pact files will be generated in `service-a/pacts/`.

#### Publish the generated Pact files to the Pact Broker:

```bash
npm run publish:pacts
```

#### Provider (Service B)

Verifies the provider against the generated Pact files:

```bash
npm run test:service-b
```

---

## Contract Testing Workflow

1. **Write Consumer Test:**  
   In `service-a/test/consumer.pact.spec.ts`, define the expected interactions with the provider.

2. **Generate Pact Files:**  
   Run the consumer tests in Service A. This produces Pact JSON files describing the contract.

3. **Publish Pact Files (Optional):**  
   If using a Pact Broker, publish the generated Pact files using the provided script. This example uses a local Pact Broker running in a Docker container.

4. **Verify Provider:**  
   In Service B, run the provider verification tests. These tests will fetch the Pact files and verify that Service B’s API matches the contract.

---

## Scripts

Each service defines the following npm scripts:

- `npm run test:service-a` – Run Jest tests (with Pact integration)
- `npm run test:service-b` – Run Jest tests (with Pact integration)
- `npm run publish:pacts` – Publish the generated Pact files to the Pact Broker
- `npm run start:pact-broker` – Start the Pact Broker
- `npm run setup` – Install dependencies for both services

---

## Troubleshooting

- **TypeScript Errors:**  
  Make sure `ts-jest` and `ts-node` are installed and `jest.config.ts` is present in each service.

- **Contract Mismatches:**  
  If provider verification fails, check that the API responses match the contract generated by the consumer.

- **Pact Broker:**  
  If you use a Pact Broker, configure the broker URL in the provider test setup.

---

## Useful Links

- [Pact Documentation](https://docs.pact.io/)
- [Pact JS](https://github.com/pact-foundation/pact-js)
- [Consumer-Driven Contracts](https://martinfowler.com/articles/consumerDrivenContracts.html)

---

## License

MIT
